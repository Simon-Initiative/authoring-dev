global
    daemon
    maxconn 3000

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http-in
    bind *:80
    bind *:443 ssl crt /certs/combined.pem
    redirect scheme https if !{ ssl_fc }
    reqadd X-Forwarded-Proto:\ https
    use_backend content if { path_beg /content-service/ }
    use_backend keycloak if { path_beg /auth/ }
    default_backend nginx

backend nginx
    server nginx1 nginx:80 check

backend content
    server content1 content:8080 check

backend keycloak
    server keycloak1 keycloak-sso:8080 check
